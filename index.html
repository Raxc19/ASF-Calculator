<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASF Construction Cost Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            color: #000000;
            line-height: 1.6;
        }
        
        .header {
            background: #ffffff;
            padding: 8px 0 0 0;
            border-bottom: 4px solid #ffd700;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.3);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: -15px;
        }
        
        .logo-link {
            display: inline-block;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .logo-link:hover {
            transform: scale(1.02);
        }
        
        .logo-image {
            height: 160px;
            width: auto;
            max-width: 500px;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
            transition: all 0.3s ease;
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
        }
        
        .logo-image:hover {
            filter: drop-shadow(3px 3px 8px rgba(0, 0, 0, 0.3));
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .dark-mode-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            border-radius: 25px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            user-select: none;
        }
        
        .dark-mode-toggle:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }
        
        .toggle-icon {
            font-size: 16px;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .toggle-icon.rotating {
            transform: rotate(360deg) scale(1.2);
        }
        
        .toggle-text {
            color: #000000;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        /* Dark Mode Styles with Smooth Dissolve Transitions */
        body {
            transition: background-color 1.5s ease-in-out, 
                        color 1.5s ease-in-out;
        }
        
        .header,
        .contact-bar,
        .calculator-form,
        .live-preview,
        .modal-content,
        .summary-card,
        .breakdown-section,
        .materials-table,
        .tier-card,
        .checkbox-group,
        .house-details,
        .pricing-tiers,
        .options-section {
            transition: background-color 1.5s ease-in-out, 
                        border-color 1.5s ease-in-out, 
                        color 1.5s ease-in-out,
                        box-shadow 1.5s ease-in-out;
        }
        
        .form-section input,
        .form-section select,
        .detail-row select,
        .detail-row input,
        .detail-row label,
        .form-section label,
        .section-title,
        .main-title h1,
        .main-title p,
        .preview-title,
        .cost-item,
        .cost-amount,
        .contact-bar-label,
        .contact-bar-value,
        .tier-card h4,
        .tier-card p,
        .tier-specs div,
        .checkbox-group label,
        .toggle-text {
            transition: background-color 1.5s ease-in-out, 
                        border-color 1.5s ease-in-out, 
                        color 1.5s ease-in-out;
        }
        
        .header-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            border: 2px solid #ffd700;
        }
        
        /* Contact Bar */
        .contact-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: #ffffff;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            padding: 15px 0;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .contact-bar-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .contact-bar-item:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .contact-bar-icon {
            font-size: 20px;
            color: #ffd700;
            flex-shrink: 0;
        }
        
        .contact-bar-text {
            text-align: left;
            flex: 1;
        }
        
        .contact-bar-label {
            font-size: 12px;
            font-weight: bold;
            color: #666666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }
        
        .contact-bar-value {
            font-size: 14px;
            color: #000000;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .contact-bar-value a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .contact-bar-value a:hover {
            color: #ffd700;
        }
        
        .hover-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            transform: translateX(-100%);
            transition: transform 0.4s ease;
        }
        
        .contact-bar-item:hover .hover-line {
            transform: translateX(0);
        }
        
        .contact-bar-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            bottom: 20%;
            width: 1px;
            background: rgba(255, 215, 0, 0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px 40px 20px;
        }
        
        .main-title {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .main-title h1 {
            color: #000000;
            font-size: 3.5em;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .main-title p {
            color: #333333;
            font-size: 1.4em;
            font-weight: 300;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
            margin-bottom: 50px;
        }
        
        .calculator-form {
            background: #ffffff;
            padding: 50px;
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 3px solid #ffd700;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section label {
            display: block;
            color: #000000;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .form-section input, .form-section select {
            width: 100%;
            padding: 18px 20px;
            background: #ffffff;
            border: 3px solid #ffd700;
            border-radius: 12px;
            font-size: 1.3em;
            color: #000000;
        }
        
        .house-details {
            background: rgba(255, 215, 0, 0.1);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 2px solid #ffd700;
        }
        
        .section-title {
            color: #000000;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .detail-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-row label {
            min-width: 120px;
            font-weight: bold;
            color: #000000;
        }
        
        .detail-row select {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            background: #ffffff;
            color: #000000;
            font-size: 1em;
        }
        
        .pricing-tiers {
            background: rgba(255, 215, 0, 0.15);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 2px solid #ffd700;
        }
        
        .tier-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .tier-card {
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            transition: all 1.5s ease-in-out;
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .tier-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }
        
        .tier-card.selected {
            background: rgba(255, 215, 0, 0.15);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            transform: translateY(-3px);
        }
        
        .tier-card h4 {
            color: #000000;
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .tier-card p {
            color: #333333;
            margin-bottom: 15px;
        }
        
        .tier-specs {
            background: rgba(255, 215, 0, 0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .tier-specs div {
            margin-bottom: 5px;
            color: #000000;
            font-weight: 500;
        }
        
        .options-section {
            background: rgba(255, 215, 0, 0.1);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 2px solid #ffd700;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
            position: relative;
            overflow: hidden;
        }
        
        .checkbox-group:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-right: 18px;
            accent-color: #ffd700;
            cursor: pointer;
        }
        
        .checkbox-group label {
            color: #000000;
            font-size: 1.2em;
            cursor: pointer;
            margin-bottom: 0;
            font-weight: 500;
        }
        
        .calculate-btn {
            width: 100%;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 215, 0, 0.6);
        }
        
        .live-preview {
            background: #ffffff;
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #ffd700;
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        .preview-title {
            color: #000000;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 15px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            font-size: 1.1em;
        }
        
        .cost-item:last-child {
            border-bottom: none;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            font-weight: bold;
            padding: 20px;
            margin-top: 15px;
            border-radius: 12px;
            font-size: 1.3em;
        }
        
        .cost-amount {
            font-weight: bold;
            color: #000000;
            transition: all 0.4s ease;
        }
        
        .cost-amount.updating {
            filter: blur(4px);
            opacity: 0.5;
            transform: scale(0.96);
            color: #666666;
        }
        
        .cost-amount.updated {
            filter: blur(0px);
            opacity: 1;
            transform: scale(1);
            animation: highlightUpdate 0.8s ease;
        }
        
        .live-preview.calculating {
            filter: blur(2px);
            opacity: 0.8;
            transform: scale(0.99);
        }
        
        .live-preview.calculated {
            filter: blur(0px);
            opacity: 1;
            transform: scale(1);
            animation: previewPulse 0.6s ease;
        }
        
        @keyframes highlightUpdate {
            0% { 
                background: rgba(255, 215, 0, 0.4);
                border-radius: 8px;
                padding: 4px 8px;
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            }
            50% { 
                background: rgba(255, 215, 0, 0.7);
                transform: scale(1.05);
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
            }
            100% { 
                background: transparent;
                transform: scale(1);
                padding: 0;
                box-shadow: none;
            }
        }
        
        @keyframes previewPulse {
            0% { 
                box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
            }
            50% { 
                box-shadow: 0 15px 35px rgba(255, 215, 0, 0.6);
                transform: translateY(-2px);
            }
            100% { 
                box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
                transform: translateY(0);
            }
        }
        
        .details-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            border: 2px solid #ffd700;
            width: 100%;
            margin-top: 20px;
        }
        
        .details-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        .png-download-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            border: 2px solid #ffd700;
        }
        
        .png-download-btn:hover {
            background: linear-gradient(45deg, #ffed4e, #ffd700);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            overflow-y: auto;
        }
        
        .modal-content {
            background: #ffffff;
            margin: 2% auto;
            padding: 40px;
            border-radius: 20px;
            max-width: 1200px;
            width: 90%;
            position: relative;
            border: 3px solid #ffd700;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2em;
            cursor: pointer;
            color: #ffd700;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            color: #ffed4e;
            transform: scale(1.1);
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .modal-header h2 {
            color: #000000;
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .project-info {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: #ffffff;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            text-align: center;
        }
        
        .summary-card h4 {
            color: #000000;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .amount {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .breakdown-section {
            background: rgba(255, 215, 0, 0.1);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            margin: 30px 0;
        }
        
        .breakdown-title {
            color: #000000;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .materials-table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ffd700;
        }
        
        .materials-table th {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            padding: 15px;
            font-weight: bold;
            border-bottom: 2px solid #ffd700;
        }
        
        .materials-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            color: #000000;
        }
        
        .materials-table tr:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .category-header {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
            padding: 15px;
            font-weight: bold;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
            border-radius: 10px;
        }
        
        /* Contact Footer */
        .contact-footer {
            background: #2c2c2c;
            padding: 40px 0;
            margin-top: 60px;
        }
        
        .contact-footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            align-items: center;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .contact-icon-box {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .contact-icon {
            font-size: 24px;
            color: #000000;
            font-weight: bold;
        }
        
        .contact-details {
            flex: 1;
        }
        
        .contact-label {
            color: #ffffff;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 1px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .contact-value {
            color: #ffffff;
            font-size: 18px;
            font-weight: 500;
            line-height: 1.4;
        }
        
        .contact-value:hover {
            color: #ffd700;
            transition: color 0.3s ease;
        }
        
        /* Dark Mode Styles */
        body {
            transition: background-color 1.5s ease-in-out, color 1.5s ease-in-out;
        }
        
        body.dark-mode {
            background: #1a1a1a;
            color: #ffffff;
        }
        
        body.dark-mode .header {
            background: #2c2c2c;
            border-bottom-color: #ffd700;
        }
        
        body.dark-mode .contact-bar {
            background: #2c2c2c;
        }
        
        body.dark-mode .contact-bar-item:hover {
            background: rgba(255, 215, 0, 0.15);
        }
        
        body.dark-mode .contact-bar-label {
            color: #aaaaaa;
        }
        
        body.dark-mode .contact-bar-value {
            color: #ffffff;
        }
        
        body.dark-mode .main-title h1,
        body.dark-mode .main-title p,
        body.dark-mode .section-title,
        body.dark-mode .form-section label {
            color: #ffffff;
        }
        
        body.dark-mode .calculator-form {
            background: #2c2c2c;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .form-section input,
        body.dark-mode .form-section select {
            background: #1a1a1a;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .house-details,
        body.dark-mode .pricing-tiers,
        body.dark-mode .options-section {
            background: rgba(255, 215, 0, 0.05);
            border-color: #ffd700;
        }
        
        body.dark-mode .detail-row label {
            color: #ffffff;
        }
        
        body.dark-mode .detail-row select,
        body.dark-mode .detail-row input {
            background: #1a1a1a;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .tier-card {
            background: #3a3a3a;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .tier-card h4 {
            color: #ffffff;
        }
        
        body.dark-mode .tier-card p {
            color: #cccccc;
        }
        
        body.dark-mode .tier-specs div {
            color: #ffffff;
        }
        
        body.dark-mode .tier-card:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        body.dark-mode .tier-card.selected {
            background: rgba(255, 215, 0, 0.2);
        }
        
        body.dark-mode .checkbox-group {
            background: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .checkbox-group label {
            color: #ffffff;
        }
        
        body.dark-mode .checkbox-group:hover {
            background: rgba(255, 215, 0, 0.15);
        }
        
        body.dark-mode .live-preview {
            background: #2c2c2c;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .preview-title {
            color: #ffffff;
        }
        
        body.dark-mode .cost-item {
            border-bottom-color: rgba(255, 215, 0, 0.3);
            color: #ffffff;
        }
        
        body.dark-mode .cost-amount {
            color: #ffffff;
        }
        
        body.dark-mode .modal-content {
            background: #2c2c2c;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .modal-header h2 {
            color: #ffffff;
        }
        
        body.dark-mode .summary-card {
            background: #3a3a3a;
            border-color: #ffd700;
            color: #ffffff;
        }
        
        body.dark-mode .summary-card h4 {
            color: #ffffff;
        }
        
        body.dark-mode .breakdown-section {
            background: rgba(255, 215, 0, 0.05);
            border-color: #ffd700;
        }
        
        body.dark-mode .breakdown-title {
            color: #ffffff;
        }
        
        body.dark-mode .materials-table {
            background: #3a3a3a;
            border-color: #ffd700;
        }
        
        body.dark-mode .materials-table th {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000000;
        }
        
        body.dark-mode .materials-table td {
            color: #ffffff;
            border-bottom-color: rgba(255, 215, 0, 0.2);
        }
        
        body.dark-mode .materials-table tr:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        body.dark-mode .toggle-text {
            color: #ffffff;
        }
        
        /* Hidden Admin Access */
        .admin-access {
            position: absolute;
            bottom: 5px;
            right: 20px;
            opacity: 0.1;
            font-size: 8px;
            cursor: pointer;
            user-select: none;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .live-preview {
                position: relative;
                top: 0;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 3px 0 0 0;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 5px;
                padding: 0 15px;
                min-height: auto;
            }
            
            .header-badge {
                display: none;
            }
            
            .header-right {
                display: none;
            }
            
            .logo-image {
                height: 200px;
                max-width: 500px;
                margin-bottom: -5px;
            }
            
            .contact-bar {
                display: none;
            }
            
            .main-title h1 {
                font-size: 2.2em;
                line-height: 1.2;
            }
            
            .main-title p {
                font-size: 1.1em;
            }
            
            .calculator-form {
                padding: 25px 20px;
                margin: 0 10px;
            }
            
            .form-section input, .form-section select {
                padding: 20px 15px;
                font-size: 16px;
                border-radius: 8px;
            }
            
            .house-details {
                padding: 20px 15px;
                margin: 20px 0;
            }
            
            .detail-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .detail-row label {
                min-width: auto;
                font-size: 1em;
                margin-bottom: 5px;
            }
            
            .detail-row select, .detail-row input {
                padding: 15px 12px;
                font-size: 16px;
                min-height: 48px;
            }
            
            .pricing-tiers {
                padding: 20px 15px;
                margin: 20px 0;
            }
            
            .tier-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .tier-card {
                padding: 20px 15px;
                margin-bottom: 10px;
            }
            
            .tier-card h4 {
                font-size: 1.2em;
            }
            
            .options-section {
                padding: 20px 15px;
                margin: 20px 0;
            }
            
            .checkbox-group {
                padding: 20px 15px;
                margin-bottom: 15px;
                border-radius: 10px;
                min-height: 60px;
            }
            
            .checkbox-group input[type="checkbox"] {
                width: 24px;
                height: 24px;
                margin-right: 15px;
            }
            
            .checkbox-group label {
                font-size: 1.1em;
                line-height: 1.4;
            }
            
            .calculate-btn {
                padding: 18px 15px;
                font-size: 1.3em;
                margin-top: 20px;
                min-height: 60px;
            }
            
            .live-preview {
                position: relative;
                top: 0;
                margin: 20px 10px 0 10px;
                padding: 20px 15px;
            }
            
            .preview-title {
                font-size: 1.3em;
                margin-bottom: 20px;
            }
            
            .cost-item {
                padding: 18px 0;
                font-size: 1em;
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .cost-item:last-child {
                padding: 20px 15px;
                font-size: 1.2em;
                text-align: center;
            }
            
            .details-btn {
                padding: 15px 20px;
                font-size: 1em;
                margin-top: 15px;
                min-height: 50px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px 15px;
                margin: 2% auto;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .modal-header h2 {
                font-size: 1.8em;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .summary-card {
                padding: 20px 15px;
            }
            
            .amount {
                font-size: 1.8em;
            }
            
            .breakdown-section {
                padding: 20px 15px;
                margin: 20px 0;
            }
            
            .materials-table {
                font-size: 14px;
            }
            
            .materials-table th, .materials-table td {
                padding: 10px 8px;
            }
            
            .contact-footer-content {
                grid-template-columns: 1fr;
                gap: 25px;
                text-align: center;
                padding: 0 15px;
            }
            
            .contact-item {
                justify-content: center;
                text-align: center;
            }
            
            .contact-icon-box {
                width: 50px;
                height: 50px;
            }
            
            .contact-icon {
                font-size: 20px;
            }
            
            .contact-value {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <a href="https://aswframing.com/" target="_blank" rel="noopener noreferrer" class="logo-link">
                    <img src="logo.png" alt="ASF Design Logo" class="logo-image">
                </a>
            </div>
            
            <div class="header-right">
                <div class="dark-mode-toggle" onclick="toggleDarkMode()">
                    <div class="toggle-icon" id="theme-icon">🌙</div>
                    <span class="toggle-text" id="theme-text">Dark Mode</span>
                </div>
                
                <div class="header-badge">
                    Current Las Vegas Prices<br>
                    <small style="opacity: 0.8;">Updated 2025</small>
                </div>
            </div>
            
            <!-- Hidden Admin Link -->
            <div class="admin-access" id="admin-trigger">
                ⚙️
            </div>
        </div>
        
        <!-- Contact Bar Below Logo -->
        <div class="contact-bar">
            <div class="contact-bar-item" data-contact="address">
                <div class="contact-bar-icon">📍</div>
                <div class="contact-bar-text">
                    <div class="contact-bar-label">Address</div>
                    <div class="contact-bar-value">4485 Riviera Ridge Ave, Las Vegas, NV</div>
                </div>
                <div class="hover-line"></div>
            </div>
            
            <div class="contact-bar-item" data-contact="email">
                <div class="contact-bar-icon">✉️</div>
                <div class="contact-bar-text">
                    <div class="contact-bar-label">Email</div>
                    <div class="contact-bar-value">
                        <a href="mailto:info@aswframing.com">info@aswframing.com</a>
                    </div>
                </div>
                <div class="hover-line"></div>
            </div>
            
            <div class="contact-bar-item" data-contact="phone">
                <div class="contact-bar-icon">📞</div>
                <div class="contact-bar-text">
                    <div class="contact-bar-label">Phone</div>
                    <div class="contact-bar-value">
                        <a href="tel:(702) 643-2900">(702) 643-2900</a>
                    </div>
                </div>
                <div class="hover-line"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="main-title">
            <h1>🏗️ Construction Cost Calculator</h1>
            <p>Professional estimates with detailed material and labor breakdowns</p>
        </div>

        <div class="main-content">
            <div class="calculator-form">
                <div class="form-section">
                    <label for="sqft">🏠 Project Square Footage</label>
                    <input type="number" id="sqft" placeholder="Enter total square footage" min="500" max="100000">
                </div>
                
                <div class="house-details">
                    <div class="section-title">🏡 Land & Location (Optional)</div>
                    
                    <div class="detail-row">
                        <label>Land Cost:</label>
                        <select id="land-cost-type">
                            <option value="none">No land cost</option>
                            <option value="manual">Enter land cost</option>
                            <option value="estimate">Estimate by sq ft</option>
                        </select>
                    </div>
                    
                    <div class="detail-row" id="manual-land-cost" style="display: none;">
                        <label>Land Price:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em; font-weight: bold; color: #ffd700;">$</span>
                            <input type="number" id="land-price" placeholder="Enter land cost" min="0" style="flex: 1; padding: 12px 15px; border: 2px solid #ffd700; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div class="detail-row" id="estimate-land-cost" style="display: none;">
                        <label>Land Size:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="land-sqft" placeholder="Land sq ft" min="0" style="width: 150px; padding: 12px 15px; border: 2px solid #ffd700; border-radius: 8px;">
                            <span>×</span>
                            <select id="land-price-per-sqft" style="flex: 1; padding: 12px 15px; border: 2px solid #ffd700; border-radius: 8px;">
                                <option value="8">$8/sq ft - Rural/Remote areas</option>
                                <option value="15">$15/sq ft - Outer Las Vegas suburbs</option>
                                <option value="25" selected>$25/sq ft - Standard Las Vegas</option>
                                <option value="40">$40/sq ft - Desirable neighborhoods</option>
                                <option value="60">$60/sq ft - Premium areas (Summerlin, etc.)</option>
                                <option value="80">$80/sq ft - Luxury areas (The Lakes, etc.)</option>
                                <option value="120">$120/sq ft - High-end (Red Rock, etc.)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="house-details">
                    <div class="section-title">🏡 House Details</div>
                    
                    <div class="detail-row">
                        <label>Windows:</label>
                        <select id="windows">
                            <option value="0">Select number of windows</option>
                            <option value="5">5 windows ($3,000)</option>
                            <option value="8">8 windows ($4,800)</option>
                            <option value="10">10 windows ($6,000)</option>
                            <option value="12">12 windows ($7,200)</option>
                            <option value="15">15 windows ($9,000)</option>
                            <option value="18">18 windows ($10,800)</option>
                            <option value="20">20 windows ($12,000)</option>
                            <option value="25">25+ windows ($15,000+)</option>
                        </select>
                    </div>
                    
                    <div class="detail-row">
                        <label>Bedrooms:</label>
                        <select id="bedrooms">
                            <option value="1">1 bedroom</option>
                            <option value="2">2 bedrooms</option>
                            <option value="3">3 bedrooms</option>
                            <option value="4">4 bedrooms</option>
                            <option value="5">5+ bedrooms</option>
                        </select>
                    </div>
                    
                    <div class="detail-row">
                        <label>Bathrooms:</label>
                        <select id="bathrooms">
                            <option value="1">1 bathroom</option>
                            <option value="1.5">1.5 bathrooms</option>
                            <option value="2">2 bathrooms</option>
                            <option value="2.5">2.5 bathrooms</option>
                            <option value="3">3 bathrooms</option>
                            <option value="3.5">3.5+ bathrooms</option>
                        </select>
                    </div>
                    
                    <div class="detail-row">
                        <label>Kitchens:</label>
                        <select id="kitchens">
                            <option value="1">1 kitchen</option>
                            <option value="2">2 kitchens</option>
                            <option value="3">3+ kitchens</option>
                        </select>
                    </div>
                    
                    <div class="detail-row">
                        <label>Garages:</label>
                        <select id="garages">
                            <option value="0">No garage</option>
                            <option value="1">1-car garage</option>
                            <option value="2">2-car garage</option>
                            <option value="3">3+ car garage</option>
                        </select>
                    </div>
                    
                    <div class="detail-row">
                        <label>Stories:</label>
                        <select id="stories">
                            <option value="1">1 story</option>
                            <option value="1.5">1.5 stories</option>
                            <option value="2">2 stories</option>
                            <option value="2.5">2.5+ stories</option>
                        </select>
                    </div>
                </div>
                
                <div class="pricing-tiers">
                    <div class="section-title">💰 Select Pricing Tier</div>
                    
                    <div class="tier-cards">
                        <div class="tier-card selected" data-tier="residential">
                            <h4>🏠 Residential</h4>
                            <p>Standard residential construction with quality materials</p>
                            <div class="tier-specs">
                                <div>📏 Size: 800-5,000 sq ft</div>
                                <div>📦 Materials: Standard rates</div>
                                <div>👷 Labor: $85/sq ft</div>
                                <div>💼 Profit: 19%</div>
                            </div>
                        </div>
                        
                        <div class="tier-card" data-tier="custom">
                            <h4>🏆 Custom Home</h4>
                            <p>High-end custom construction with premium materials</p>
                            <div class="tier-specs">
                                <div>📏 Size: 2,500-15,000 sq ft</div>
                                <div>📦 Materials: +15% premium</div>
                                <div>👷 Labor: +25% precision</div>
                                <div>💼 Profit: 22%</div>
                            </div>
                        </div>
                        
                        <div class="tier-card" data-tier="commercial">
                            <h4>🏢 Commercial</h4>
                            <p>Commercial projects with efficiency pricing</p>
                            <div class="tier-specs">
                                <div>📏 Size: 5,000-100,000 sq ft</div>
                                <div>📦 Materials: -8% volume</div>
                                <div>👷 Labor: -5% efficiency</div>
                                <div>💼 Profit: 16%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="options-section">
                    <div class="section-title">📋 Estimate Options</div>
                    
                    <div class="checkbox-group" data-checkbox="include_labor">
                        <input type="checkbox" id="include_labor">
                        <label for="include_labor">Include Labor Costs</label>
                    </div>
                    
                    <div class="checkbox-group" data-checkbox="include_profit">
                        <input type="checkbox" id="include_profit">
                        <label for="include_profit">Include Contractor Profit</label>
                    </div>
                    
                    <div class="checkbox-group" data-checkbox="include_specialized">
                        <input type="checkbox" id="include_specialized">
                        <label for="include_specialized">Include Specialized Work (HVAC, Insulation, Painting)</label>
                    </div>
                </div>
                
                <button type="button" class="calculate-btn" onclick="openDetailsModal()">
                    💰 Calculate Construction Cost
                </button>
            </div>
            
            <div class="live-preview" id="live-preview">
                <div class="preview-title">💵 Live Cost Preview</div>
                
                <div class="cost-item">
                    <span>🧱 Materials Cost:</span>
                    <span class="cost-amount" id="materials-cost">$0</span>
                </div>
                
                <div class="cost-item">
                    <span>👷 Labor Cost:</span>
                    <span class="cost-amount" id="labor-cost">$0</span>
                </div>
                
                <div class="cost-item">
                    <span>📋 Other Costs:</span>
                    <span class="cost-amount" id="other-cost">$0</span>
                </div>
                
                <div class="cost-item">
                    <span>💼 Profit:</span>
                    <span class="cost-amount" id="profit-cost">$0</span>
                </div>
                
                <div class="cost-item" style="border-bottom: 1px solid rgba(255, 215, 0, 0.3);">
                    <span>🏗️ Construction Total:</span>
                    <span class="cost-amount" id="construction-total">$0</span>
                </div>
                
                <div class="cost-item" id="land-cost-item" style="display: none;">
                    <span>🏞️ Land Cost:</span>
                    <span class="cost-amount" id="land-cost-display">$0</span>
                </div>
                
                <div class="cost-item">
                    <span>🏆 TOTAL PROJECT VALUE:</span>
                    <span class="cost-amount" id="total-cost">$0</span>
                </div>
                
                <button type="button" class="details-btn" onclick="openDetailsModal()">
                    📊 View Detailed Breakdown
                </button>
                
                <button type="button" class="details-btn png-download-btn" onclick="downloadEstimateImage()" style="margin-top: 10px;">
                    📥 Download PNG Estimate
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hidden Canvas for PNG Generation -->
    <canvas id="estimate-canvas" style="display: none;"></canvas>
    
    <!-- Contact Footer Section -->
    <div class="contact-footer">
        <div class="contact-footer-content">
            <div class="contact-item">
                <div class="contact-icon-box">
                    <div class="contact-icon">📍</div>
                </div>
                <div class="contact-details">
                    <div class="contact-label">ADDRESS</div>
                    <div class="contact-value">4485 Riviera Ridge Ave. Las Vegas, NV 89115</div>
                </div>
            </div>
            
            <div class="contact-item">
                <div class="contact-icon-box">
                    <div class="contact-icon">📧</div>
                </div>
                <div class="contact-details">
                    <div class="contact-label">SEND MAIL US</div>
                    <div class="contact-value">info@aswframing.com</div>
                </div>
            </div>
            
            <div class="contact-item">
                <div class="contact-icon-box">
                    <div class="contact-icon">📱</div>
                </div>
                <div class="contact-details">
                    <div class="contact-label">CALL US 24/7</div>
                    <div class="contact-value">(702) 643-2900</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Detailed Results Modal -->
    <div class="modal" id="details-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            
            <div class="modal-header">
                <h2>📊 Construction Cost Breakdown</h2>
                <div class="project-info">
                    <h3 id="project-title">Project: 0 Square Feet</h3>
                    <p>Las Vegas, Nevada • Sales Tax: 8.375% • Professional ASF-Design Estimate</p>
                </div>
            </div>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <h4>💰 Total Project Cost</h4>
                    <div class="amount" id="modal-total-cost">$0</div>
                    <div id="cost-per-sqft">$0 per sq ft</div>
                </div>
                
                <div class="summary-card">
                    <h4>🧱 Materials Cost</h4>
                    <div class="amount" id="modal-materials-cost">$0</div>
                    <div>Includes 8.375% tax</div>
                </div>
                
                <div class="summary-card">
                    <h4>👷 Labor Cost</h4>
                    <div class="amount" id="modal-labor-cost">$0</div>
                    <div id="labor-per-sqft">$0 per sq ft</div>
                </div>
            </div>
            
            <div class="breakdown-section">
                <div class="breakdown-title">💵 Detailed Cost Breakdown</div>
                <div id="cost-breakdown-details"></div>
            </div>
            
            <div class="breakdown-section">
                <div class="breakdown-title">🛒 Materials Shopping List</div>
                <div id="materials-breakdown"></div>
            </div>
            
            <div class="breakdown-section">
                <div class="breakdown-title">👷 Labor Breakdown</div>
                <div id="labor-breakdown"></div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced ASF Calculator Class with Admin Price Sync
        class ASFCalculator {
            constructor() {
                this.data = {
                    sqft: 0,
                    pricing_tier: 'residential',
                    include_labor: false,
                    include_profit: false,
                    include_specialized: false,
                    windows: 0,
                    bedrooms: 1,
                    bathrooms: 1,
                    kitchens: 1,
                    garages: 0,
                    stories: 1,
                    land_cost_type: 'none',
                    land_price: 0,
                    land_sqft: 0,
                    land_price_per_sqft: 25
                };
                
                this.costs = {
                    materials: 0,
                    labor: 0,
                    other: 0,
                    profit: 0,
                    construction_total: 0,
                    land_cost: 0,
                    total: 0
                };
                
                this.tiers = {
                    residential: { materials: 1.0, labor: 1.0, profit: 0.19 },
                    custom: { materials: 1.15, labor: 1.25, profit: 0.22 },
                    commercial: { materials: 0.92, labor: 0.95, profit: 0.16 }
                };
                
                // Default material prices - will be overridden by admin prices if available
                this.materialPrices = {
                    concrete: 6.72,
                    lumber_2x4: 3.74,
                    lumber_2x6: 7.98,
                    floor_joists: 18.50,
                    rebar: 10.94,
                    framing_nails: 89.97,
                    roofing_nails: 67.48,
                    drywall_screws: 18.97,
                    shingles: 47.12,
                    roof_underlayment: 89.50,
                    drywall: 23.98,
                    joint_compound: 15.75,
                    flooring: 2.48,
                    flooring_underlayment: 0.75,
                    electrical: 146.00,
                    gfci_outlets: 18.50,
                    copper_pipe: 28.75,
                    pex_tubing: 89.00,
                    insulation: 1.12,
                    blown_insulation: 12.50
                };
                
                this.materials = [
                    // Foundation & Structure
                    { name: "90lb Concrete Mix", category: "Foundation", qty_per_sqft: 0.16, priceKey: "concrete", unit: "bags" },
                    { name: "#4 Rebar 20ft", category: "Foundation", qty_per_sqft: 0.05, priceKey: "rebar", unit: "pieces" },
                    
                    // Framing
                    { name: "2x4x8 Premium Fir", category: "Framing", qty_per_sqft: 2.1, priceKey: "lumber_2x4", unit: "pieces" },
                    { name: "2x6x8 Douglas Fir", category: "Framing", qty_per_sqft: 0.8, priceKey: "lumber_2x6", unit: "pieces" },
                    { name: "2x8x16 Floor Joists", category: "Framing", qty_per_sqft: 0.4, priceKey: "floor_joists", unit: "pieces" },
                    
                    // Fasteners
                    { name: "3-1/2\" Framing Nails (50lb)", category: "Fasteners", qty_per_sqft: 0.008, priceKey: "framing_nails", unit: "boxes" },
                    { name: "1-1/4\" Roofing Nails (30lb)", category: "Fasteners", qty_per_sqft: 0.006, priceKey: "roofing_nails", unit: "boxes" },
                    { name: "Drywall Screws (5lb)", category: "Fasteners", qty_per_sqft: 0.003, priceKey: "drywall_screws", unit: "boxes" },
                    
                    // Roofing
                    { name: "GAF Timberline HDZ Shingles", category: "Roofing", qty_per_sqft: 0.03, priceKey: "shingles", unit: "bundles" },
                    { name: "Roof Underlayment", category: "Roofing", qty_per_sqft: 0.01, priceKey: "roof_underlayment", unit: "rolls" },
                    
                    // Electrical
                    { name: "12 AWG Romex 250ft", category: "Electrical", qty_per_sqft: 0.013, priceKey: "electrical", unit: "rolls" },
                    { name: "GFCI Outlets", category: "Electrical", qty_per_sqft: 0.05, priceKey: "gfci_outlets", unit: "pieces" },
                    
                    // Plumbing
                    { name: "3/4\" Copper Pipe", category: "Plumbing", qty_per_sqft: 0.15, priceKey: "copper_pipe", unit: "pieces" },
                    { name: "1/2\" PEX Tubing 100ft", category: "Plumbing", qty_per_sqft: 0.08, priceKey: "pex_tubing", unit: "rolls" },
                    
                    // Insulation
                    { name: "R-15 Wall Insulation", category: "Insulation", qty_per_sqft: 1.0, priceKey: "insulation", unit: "sq ft" },
                    { name: "R-30 Blown-In Insulation", category: "Insulation", qty_per_sqft: 0.04, priceKey: "blown_insulation", unit: "bags" },
                    
                    // Drywall
                    { name: "1/2\" Drywall 4x8", category: "Drywall", qty_per_sqft: 0.075, priceKey: "drywall", unit: "sheets" },
                    { name: "Joint Compound 50lb", category: "Drywall", qty_per_sqft: 0.02, priceKey: "joint_compound", unit: "buckets" },
                    
                    // Flooring
                    { name: "Laminate Flooring", category: "Flooring", qty_per_sqft: 0.85, priceKey: "flooring", unit: "sq ft" },
                    { name: "Flooring Underlayment", category: "Flooring", qty_per_sqft: 0.85, priceKey: "flooring_underlayment", unit: "sq ft" }
                ];
                
                this.laborRates = [
                    { name: "Framing & Structure", rate: 15.0, timeline: "2-3 weeks" },
                    { name: "Electrical Work", rate: 8.5, timeline: "1-2 weeks" },
                    { name: "Plumbing Installation", rate: 9.0, timeline: "1-2 weeks" },
                    { name: "Drywall & Finishing", rate: 12.0, timeline: "2-3 weeks" },
                    { name: "Flooring Installation", rate: 8.0, timeline: "1-2 weeks" },
                    { name: "Roofing Installation", rate: 6.5, timeline: "1 week" },
                    { name: "Exterior Siding", rate: 7.0, timeline: "1-2 weeks" },
                    { name: "Interior Finishing", rate: 18.5, timeline: "2-3 weeks" }
                ];
                
                this.isCalculating = false;
                this.updateTimeout = null;
                
                this.init();
            }
            
            init() {
                this.loadAdminPrices(); // Load admin prices first
                this.setupEventListeners();
                this.loadSavedData();
                this.calculate();
                this.updateDisplay();
                console.log('🏗️ ASF Calculator initialized with admin price sync');
                console.log('💰 Using', Object.keys(this.getAdminPrices()).length, 'custom admin prices');
            }
            
            // Load admin prices from localStorage
            loadAdminPrices() {
                const adminPrices = this.getAdminPrices();
                if (Object.keys(adminPrices).length > 0) {
                    this.materialPrices = { ...this.materialPrices, ...adminPrices };
                    console.log('✅ Admin prices loaded:', Object.keys(adminPrices));
                }
            }
            
            getAdminPrices() {
                try {
                    return JSON.parse(localStorage.getItem('asfAdminPrices') || '{}');
                } catch (e) {
                    console.warn('Could not load admin prices');
                    return {};
                }
            }
            
            setupEventListeners() {
                // Square footage input
                document.getElementById('sqft').addEventListener('input', (e) => {
                    this.data.sqft = parseFloat(e.target.value) || 0;
                    this.updateWithBlur();
                });
                
                // Land cost event listeners
                document.getElementById('land-cost-type').addEventListener('change', (e) => {
                    this.data.land_cost_type = e.target.value;
                    this.toggleLandCostInputs();
                    this.updateWithBlur();
                });
                
                document.getElementById('land-price').addEventListener('input', (e) => {
                    this.data.land_price = parseFloat(e.target.value) || 0;
                    this.updateWithBlur();
                });
                
                document.getElementById('land-sqft').addEventListener('input', (e) => {
                    this.data.land_sqft = parseFloat(e.target.value) || 0;
                    this.updateWithBlur();
                });
                
                document.getElementById('land-price-per-sqft').addEventListener('change', (e) => {
                    this.data.land_price_per_sqft = parseFloat(e.target.value) || 25;
                    this.updateWithBlur();
                });
                
                // House details selects
                ['windows', 'bedrooms', 'bathrooms', 'kitchens', 'garages', 'stories'].forEach(field => {
                    document.getElementById(field).addEventListener('change', (e) => {
                        this.data[field] = parseFloat(e.target.value) || 0;
                        this.updateWithBlur();
                    });
                });
                
                // Checkboxes with enhanced click areas
                ['include_labor', 'include_profit', 'include_specialized'].forEach(field => {
                    const checkbox = document.getElementById(field);
                    const checkboxGroup = document.querySelector(`[data-checkbox="${field}"]`);
                    
                    checkbox.addEventListener('change', (e) => {
                        this.data[field] = e.target.checked;
                        this.updateWithBlur();
                    });
                    
                    if (checkboxGroup) {
                        checkboxGroup.addEventListener('click', (e) => {
                            if (e.target === checkbox || e.target.tagName === 'LABEL') {
                                return;
                            }
                            
                            checkbox.checked = !checkbox.checked;
                            this.data[field] = checkbox.checked;
                            this.updateWithBlur();
                            
                            checkboxGroup.style.transform = 'scale(0.98)';
                            setTimeout(() => {
                                checkboxGroup.style.transform = 'translateX(5px)';
                            }, 100);
                        });
                        
                        checkboxGroup.style.cursor = 'pointer';
                    }
                });
                
                // Tier cards
                document.querySelectorAll('.tier-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const tier = card.dataset.tier;
                        this.selectTier(tier);
                    });
                });
                
                // Listen for admin price changes
                window.addEventListener('storage', (e) => {
                    if (e.key === 'asfAdminPrices') {
                        console.log('🔄 Admin prices updated, reloading...');
                        this.loadAdminPrices();
                        if (this.data.sqft > 0) {
                            this.calculate();
                            this.updateDisplay();
                        }
                        this.showPriceUpdateNotification();
                    }
                });
            }
            
            showPriceUpdateNotification() {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(45deg, #4caf50, #66bb6a);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    font-weight: bold;
                    z-index: 10000;
                    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
                    transform: translateX(400px);
                    transition: transform 0.3s ease;
                `;
                notification.textContent = '✅ Prices updated from admin panel!';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
            
            updateWithBlur() {
                if (this.updateTimeout) {
                    clearTimeout(this.updateTimeout);
                }
                
                this.startBlurEffect();
                
                this.updateTimeout = setTimeout(() => {
                    this.calculate();
                    this.updateDisplay();
                    this.saveData();
                    this.endBlurEffect();
                }, 150);
            }
            
            startBlurEffect() {
                const previewPanel = document.getElementById('live-preview');
                const costAmounts = document.querySelectorAll('.cost-amount');
                
                previewPanel.classList.add('calculating');
                
                costAmounts.forEach(amount => {
                    amount.classList.remove('updated', 'shimmer');
                    amount.classList.add('updating');
                });
                
                this.isCalculating = true;
            }
            
            endBlurEffect() {
                const previewPanel = document.getElementById('live-preview');
                const costAmounts = document.querySelectorAll('.cost-amount');
                
                previewPanel.classList.remove('calculating');
                previewPanel.classList.add('calculated');
                
                costAmounts.forEach((amount, index) => {
                    setTimeout(() => {
                        amount.classList.remove('updating');
                        amount.classList.add('updated');
                    }, index * 50);
                });
                
                setTimeout(() => {
                    previewPanel.classList.remove('calculated');
                }, 600);
                
                this.isCalculating = false;
            }
            
            toggleLandCostInputs() {
                const manualDiv = document.getElementById('manual-land-cost');
                const estimateDiv = document.getElementById('estimate-land-cost');
                const landCostItem = document.getElementById('land-cost-item');
                
                manualDiv.style.display = this.data.land_cost_type === 'manual' ? 'flex' : 'none';
                estimateDiv.style.display = this.data.land_cost_type === 'estimate' ? 'flex' : 'none';
                
                if (this.data.land_cost_type !== 'none') {
                    landCostItem.style.display = 'flex';
                } else {
                    landCostItem.style.display = 'none';
                }
            }
            
            selectTier(tier) {
                document.querySelectorAll('.tier-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.querySelector(`[data-tier="${tier}"]`).classList.add('selected');
                this.data.pricing_tier = tier;
                this.updateWithBlur();
            }
            
            calculate() {
                if (this.data.sqft <= 0) {
                    this.costs = { materials: 0, labor: 0, other: 0, profit: 0, construction_total: 0, land_cost: 0, total: 0 };
                    return;
                }
                
                const tier = this.tiers[this.data.pricing_tier] || this.tiers.residential;
                
                // Calculate materials cost using current prices (includes admin updates)
                let materialsCost = 0;
                this.materials.forEach(material => {
                    const price = this.materialPrices[material.priceKey] || 0;
                    const quantity = material.qty_per_sqft * this.data.sqft;
                    materialsCost += quantity * price;
                });
                
                this.costs.materials = materialsCost * tier.materials * 1.08375; // with tax
                
                // Calculate labor cost
                this.costs.labor = 0;
                if (this.data.include_labor) {
                    this.costs.labor = this.data.sqft * 75.0 * tier.labor;
                    if (this.data.include_specialized) {
                        this.costs.labor += this.data.sqft * 5.0 * tier.labor;
                    }
                }
                
                // Calculate other costs
                this.costs.other = this.data.sqft * 19.0;
                
                // Add house feature costs
                if (this.data.windows > 20) this.costs.other += (this.data.windows - 20) * 300;
                if (this.data.bedrooms > 4) this.costs.other += (this.data.bedrooms - 4) * 500;
                if (this.data.bathrooms > 2.5) this.costs.other += (this.data.bathrooms - 2.5) * 2000;
                if (this.data.kitchens > 1) this.costs.other += (this.data.kitchens - 1) * 10000;
                if (this.data.garages > 2) this.costs.other += (this.data.garages - 2) * 5000;
                if (this.data.stories > 2) this.costs.other += (this.data.stories - 2) * this.data.sqft * 5.0;
                
                // Apply tier adjustments
                if (this.data.pricing_tier === 'custom') {
                    this.costs.other *= 1.05;
                } else if (this.data.pricing_tier === 'commercial') {
                    this.costs.other *= 0.98;
                }
                
                // Calculate profit
                const subtotal = this.costs.materials + this.costs.labor + this.costs.other;
                this.costs.profit = this.data.include_profit ? (subtotal * tier.profit) : 0;
                
                // Calculate construction total
                this.costs.construction_total = subtotal + this.costs.profit;
                
                // Calculate land cost
                this.costs.land_cost = 0;
                if (this.data.land_cost_type === 'manual') {
                    this.costs.land_cost = this.data.land_price;
                } else if (this.data.land_cost_type === 'estimate') {
                    this.costs.land_cost = this.data.land_sqft * this.data.land_price_per_sqft;
                }
                
                // Calculate total
                this.costs.total = this.costs.construction_total + this.costs.land_cost;
            }
            
            updateDisplay() {
                document.getElementById('materials-cost').textContent = `${Math.round(this.costs.materials).toLocaleString()}`;
                
                if (this.data.include_labor) {
                    document.getElementById('labor-cost').textContent = `${Math.round(this.costs.labor).toLocaleString()}`;
                } else {
                    document.getElementById('labor-cost').textContent = '$0 (Not Included)';
                }
                
                document.getElementById('other-cost').textContent = `${Math.round(this.costs.other).toLocaleString()}`;
                
                if (this.data.include_profit) {
                    document.getElementById('profit-cost').textContent = `${Math.round(this.costs.profit).toLocaleString()}`;
                } else {
                    document.getElementById('profit-cost').textContent = '$0 (Not Included)';
                }
                
                document.getElementById('construction-total').textContent = `${Math.round(this.costs.construction_total).toLocaleString()}`;
                
                if (this.data.land_cost_type !== 'none') {
                    document.getElementById('land-cost-display').textContent = `${Math.round(this.costs.land_cost).toLocaleString()}`;
                }
                
                document.getElementById('total-cost').textContent = `${Math.round(this.costs.total).toLocaleString()}`;
            }
            
            updateModal() {
                if (this.data.sqft <= 0) return;
                
                const costPerSqft = this.costs.total / this.data.sqft;
                const laborPerSqft = this.data.include_labor ? this.costs.labor / this.data.sqft : 0;
                
                document.getElementById('project-title').textContent = `Project: ${this.data.sqft.toLocaleString()} Square Feet`;
                document.getElementById('modal-total-cost').textContent = `${Math.round(this.costs.total).toLocaleString()}`;
                document.getElementById('cost-per-sqft').textContent = `${Math.round(costPerSqft)} per sq ft`;
                document.getElementById('modal-materials-cost').textContent = `${Math.round(this.costs.materials).toLocaleString()}`;
                
                if (this.data.include_labor) {
                    document.getElementById('modal-labor-cost').textContent = `${Math.round(this.costs.labor).toLocaleString()}`;
                    document.getElementById('labor-per-sqft').textContent = `${Math.round(laborPerSqft)} per sq ft`;
                } else {
                    document.getElementById('modal-labor-cost').textContent = '$0';
                    document.getElementById('labor-per-sqft').textContent = 'Not Included';
                }
                
                this.updateCostBreakdown();
                this.updateMaterialsBreakdown();
                this.updateLaborBreakdown();
            }
            
            updateCostBreakdown() {
                const section = document.getElementById('cost-breakdown-details');
                section.innerHTML = `
                    <div style="background: #ffffff; border: 2px solid #ffd700; border-radius: 10px; overflow: hidden;">
                        <table class="materials-table">
                            <tr>
                                <td style="font-weight: bold;">🧱 Materials (with tax):</td>
                                <td style="text-align: right; font-weight: bold;">${Math.round(this.costs.materials).toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">👷 Labor:</td>
                                <td style="text-align: right; font-weight: bold;">${this.data.include_labor ? 
                                    `${Math.round(this.costs.labor).toLocaleString()}` : '$0 (Not Included)'}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">📋 Permits & Other Costs:</td>
                                <td style="text-align: right; font-weight: bold;">${Math.round(this.costs.other).toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">💼 Contractor Profit:</td>
                                <td style="text-align: right; font-weight: bold;">${this.data.include_profit ? 
                                    `${Math.round(this.costs.profit).toLocaleString()}` : '$0 (Not Included)'}</td>
                            </tr>
                            ${this.data.land_cost_type !== 'none' ? `
                            <tr>
                                <td style="font-weight: bold;">🏞️ Land Cost:</td>
                                <td style="text-align: right; font-weight: bold;">${Math.round(this.costs.land_cost).toLocaleString()}</td>
                            </tr>
                            ` : ''}
                            <tr style="background: linear-gradient(45deg, #ffd700, #ffed4e); font-size: 1.2em;">
                                <td style="font-weight: bold;">🏆 TOTAL PROJECT COST:</td>
                                <td style="text-align: right; font-weight: bold;">${Math.round(this.costs.total).toLocaleString()}</td>
                            </tr>
                        </table>
                    </div>
                `;
            }
            
            updateMaterialsBreakdown() {
                const section = document.getElementById('materials-breakdown');
                const categories = {};
                
                // Group materials by category
                this.materials.forEach(material => {
                    if (!categories[material.category]) {
                        categories[material.category] = [];
                    }
                    
                    const quantity = Math.ceil(material.qty_per_sqft * this.data.sqft);
                    const price = this.materialPrices[material.priceKey] || 0;
                    const totalCost = quantity * price * 1.08375; // with tax
                    
                    categories[material.category].push({
                        ...material,
                        quantity,
                        price,
                        totalCost
                    });
                });
                
                let html = '';
                let grandTotal = 0;
                
                Object.keys(categories).forEach(category => {
                    const materials = categories[category];
                    const categoryTotal = materials.reduce((sum, m) => sum + m.totalCost, 0);
                    grandTotal += categoryTotal;
                    
                    html += `
                        <div class="category-header">📦 ${category} - ${Math.round(categoryTotal).toLocaleString()}</div>
                        <table class="materials-table" style="margin-bottom: 20px;">
                            <thead>
                                <tr>
                                    <th>Material</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    materials.forEach(material => {
                        html += `
                            <tr>
                                <td><strong>${material.name}</strong></td>
                                <td>${material.quantity.toLocaleString()} ${material.unit}</td>
                                <td>${material.price.toFixed(2)}</td>
                                <td style="font-weight: bold; color: #ffd700;">${Math.round(material.totalCost).toLocaleString()}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                });
                
                section.innerHTML = `
                    <div style="background: linear-gradient(45deg, #4caf50, #66bb6a); color: #fff; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; font-size: 1.3em; font-weight: bold;">
                        🛒 Total Materials Cost: ${Math.round(grandTotal).toLocaleString()} (includes 8.375% tax)
                    </div>
                    ${html}
                `;
            }
            
            updateLaborBreakdown() {
                const section = document.getElementById('labor-breakdown');
                
                if (!this.data.include_labor) {
                    section.innerHTML = `
                        <div style="text-align: center; padding: 40px; background: rgba(255, 215, 0, 0.1); border-radius: 15px; border: 2px solid #ffd700;">
                            <h3 style="color: #000; margin-bottom: 15px;">Labor Costs Not Included</h3>
                            <p style="color: #666; font-size: 1.1em;">Check "Include Labor Costs" to see detailed labor breakdown</p>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <table class="materials-table">
                        <thead>
                            <tr>
                                <th>Trade</th>
                                <th>Rate/Sq Ft</th>
                                <th>Total Cost</th>
                                <th>Timeline</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                this.laborRates.forEach(labor => {
                    const cost = this.data.sqft * labor.rate;
                    html += `
                        <tr>
                            <td><strong>${labor.name}</strong></td>
                            <td>${labor.rate.toFixed(2)}</td>
                            <td style="font-weight: bold; color: #ffd700;">${Math.round(cost).toLocaleString()}</td>
                            <td>${labor.timeline}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                section.innerHTML = html;
            }
            
            saveData() {
                localStorage.setItem('asfCalculatorData', JSON.stringify(this.data));
            }
            
            loadSavedData() {
                const saved = localStorage.getItem('asfCalculatorData');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        this.data = { ...this.data, ...data };
                        this.restoreFormState();
                    } catch (e) {
                        console.warn('Could not load saved data');
                    }
                }
            }
            
            restoreFormState() {
                document.getElementById('sqft').value = this.data.sqft || '';
                document.getElementById('windows').value = this.data.windows;
                document.getElementById('bedrooms').value = this.data.bedrooms;
                document.getElementById('bathrooms').value = this.data.bathrooms;
                document.getElementById('kitchens').value = this.data.kitchens;
                document.getElementById('garages').value = this.data.garages;
                document.getElementById('stories').value = this.data.stories;
                document.getElementById('include_labor').checked = this.data.include_labor;
                document.getElementById('include_profit').checked = this.data.include_profit;
                document.getElementById('include_specialized').checked = this.data.include_specialized;
                
                // Restore land cost settings
                document.getElementById('land-cost-type').value = this.data.land_cost_type;
                document.getElementById('land-price').value = this.data.land_price || '';
                document.getElementById('land-sqft').value = this.data.land_sqft || '';
                document.getElementById('land-price-per-sqft').value = this.data.land_price_per_sqft;
                this.toggleLandCostInputs();
                
                // Restore tier selection
                document.querySelectorAll('.tier-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.querySelector(`[data-tier="${this.data.pricing_tier}"]`).classList.add('selected');
            }
        }
        
        // Global calculator instance
        let calculator;
        
        // Enhanced PNG Download Function with Logo Support
        function downloadEstimateImage() {
            if (calculator.data.sqft <= 0) {
                alert('Please enter the square footage first!');
                document.getElementById('sqft').focus();
                return;
            }
            
            try {
                const canvas = document.getElementById('estimate-canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = 900;
                canvas.height = 1400;
                
                // Background gradient
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#ffffff');
                gradient.addColorStop(1, '#f8f9fa');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Try to load logo
                const logo = new Image();
                logo.crossOrigin = 'anonymous';
                
                logo.onload = function() {
                    drawEstimateWithLogo();
                };
                
                logo.onerror = function() {
                    drawEstimateWithTextHeader();
                };
                
                logo.src = 'logo.png';
                
                function drawEstimateWithLogo() {
                    // Clear header
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, canvas.width, 160);
                    
                    // Draw logo centered at top
                    const maxLogoWidth = 250;
                    const maxLogoHeight = 80;
                    
                    let logoWidth = maxLogoWidth;
                    let logoHeight = (logo.naturalHeight / logo.naturalWidth) * logoWidth;
                    
                    if (logoHeight > maxLogoHeight) {
                        logoHeight = maxLogoHeight;
                        logoWidth = (logo.naturalWidth / logo.naturalHeight) * logoHeight;
                    }
                    
                    const logoX = (canvas.width - logoWidth) / 2;
                    const logoY = 20;
                    
                    ctx.drawImage(logo, logoX, logoY, logoWidth, logoHeight);
                    
                    // Add subtitle
                    ctx.fillStyle = '#333333';
                    ctx.font = 'bold 22px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Professional Construction Cost Estimate', canvas.width / 2, logoY + logoHeight + 30);
                    
                    ctx.font = '16px Arial';
                    ctx.fillText('Las Vegas, Nevada • Licensed & Insured • Sales Tax: 8.375%', canvas.width / 2, logoY + logoHeight + 55);
                    
                    drawEstimateContent();
                }
                
                function drawEstimateWithTextHeader() {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, canvas.width, 160);
                    
                    ctx.fillStyle = '#E5A825';
                    ctx.font = 'bold 48px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ASF DESIGN', canvas.width / 2, 60);
                    
                    ctx.fillStyle = '#333333';
                    ctx.font = 'bold 22px Arial';
                    ctx.fillText('Professional Construction Cost Estimate', canvas.width / 2, 100);
                    
                    ctx.font = '16px Arial';
                    ctx.fillText('Las Vegas, Nevada • Licensed & Insured', canvas.width / 2, 125);
                    
                    drawEstimateContent();
                }
                
                function drawEstimateContent() {
                    // Add border line
                    ctx.strokeStyle = '#E5A825';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(0, 160);
                    ctx.lineTo(canvas.width, 160);
                    ctx.stroke();
                    
                    let yPos = 200;
                    
                    // Project Information
                    ctx.fillStyle = '#e8f4fd';
                    ctx.fillRect(40, yPos - 20, canvas.width - 80, 120);
                    ctx.strokeStyle = '#E5A825';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(40, yPos - 20, canvas.width - 80, 120);
                    
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 24px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`📊 PROJECT DETAILS`, 60, yPos + 10);
                    
                    yPos += 40;
                    ctx.font = '18px Arial';
                    const currentDate = new Date().toLocaleDateString();
                    const tierName = calculator.data.pricing_tier.charAt(0).toUpperCase() + calculator.data.pricing_tier.slice(1);
                    
                    ctx.fillText(`• Project Size: ${calculator.data.sqft.toLocaleString()} Square Feet`, 60, yPos);
                    yPos += 25;
                    ctx.fillText(`• Estimate Date: ${currentDate}`, 60, yPos);
                    yPos += 25;
                    ctx.fillText(`• Pricing Tier: ${tierName} Construction`, 60, yPos);
                    
                    // House Specifications
                    yPos += 60;
                    ctx.fillStyle = '#fff3cd';
                    ctx.fillRect(40, yPos - 20, canvas.width - 80, 160);
                    ctx.strokeStyle = '#E5A825';
                    ctx.strokeRect(40, yPos - 20, canvas.width - 80, 160);
                    
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 22px Arial';
                    ctx.fillText(`🏡 HOUSE SPECIFICATIONS`, 60, yPos + 10);
                    
                    yPos += 40;
                    ctx.font = '16px Arial';
                    
                    const leftCol = 60;
                    const rightCol = 480;
                    
                    ctx.fillText(`• Windows: ${calculator.data.windows}`, leftCol, yPos);
                    ctx.fillText(`• Garages: ${calculator.data.garages}`, rightCol, yPos);
                    yPos += 25;
                    
                    ctx.fillText(`• Bedrooms: ${calculator.data.bedrooms}`, leftCol, yPos);
                    ctx.fillText(`• Stories: ${calculator.data.stories}`, rightCol, yPos);
                    yPos += 25;
                    
                    ctx.fillText(`• Bathrooms: ${calculator.data.bathrooms}`, leftCol, yPos);
                    ctx.fillText(`• Kitchens: ${calculator.data.kitchens}`, rightCol, yPos);
                    
                    // Cost Breakdown
                    yPos += 80;
                    ctx.fillStyle = '#d4edda';
                    ctx.fillRect(40, yPos - 20, canvas.width - 80, 300);
                    ctx.strokeStyle = '#E5A825';
                    ctx.strokeRect(40, yPos - 20, canvas.width - 80, 300);
                    
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 22px Arial';
                    ctx.fillText(`💰 DETAILED COST BREAKDOWN`, 60, yPos + 10);
                    
                    yPos += 50;
                    ctx.font = '18px Arial';
                    
                    ctx.fillText(`🧱 Materials Cost (with 8.375% tax):`, 60, yPos);
                    ctx.textAlign = 'right';
                    ctx.fillText(`${Math.round(calculator.costs.materials).toLocaleString()}`, canvas.width - 60, yPos);
                    ctx.textAlign = 'left';
                    yPos += 30;
                    
                    ctx.fillText(`👷 Labor Cost:`, 60, yPos);
                    ctx.textAlign = 'right';
                    if (calculator.data.include_labor) {
                        ctx.fillText(`${Math.round(calculator.costs.labor).toLocaleString()}`, canvas.width - 60, yPos);
                    } else {
                        ctx.fillText(`$0 (Not Included)`, canvas.width - 60, yPos);
                    }
                    ctx.textAlign = 'left';
                    yPos += 30;
                    
                    ctx.fillText(`📋 Permits & Other Costs:`, 60, yPos);
                    ctx.textAlign = 'right';
                    ctx.fillText(`${Math.round(calculator.costs.other).toLocaleString()}`, canvas.width - 60, yPos);
                    ctx.textAlign = 'left';
                    yPos += 30;
                    
                    ctx.fillText(`💼 Contractor Profit:`, 60, yPos);
                    ctx.textAlign = 'right';
                    if (calculator.data.include_profit) {
                        ctx.fillText(`${Math.round(calculator.costs.profit).toLocaleString()}`, canvas.width - 60, yPos);
                    } else {
                        ctx.fillText(`$0 (Not Included)`, canvas.width - 60, yPos);
                    }
                    ctx.textAlign = 'left';
                    yPos += 30;
                    
                    if (calculator.data.land_cost_type !== 'none') {
                        ctx.fillText(`🏞️ Land Cost:`, 60, yPos);
                        ctx.textAlign = 'right';
                        ctx.fillText(`${Math.round(calculator.costs.land_cost).toLocaleString()}`, canvas.width - 60, yPos);
                        ctx.textAlign = 'left';
                        yPos += 30;
                    }
                    
                    // Total Section
                    yPos += 50;
                    ctx.fillStyle = '#E5A825';
                    ctx.fillRect(40, yPos - 30, canvas.width - 80, 80);
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(40, yPos - 30, canvas.width - 80, 80);
                    
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('🏆 TOTAL PROJECT COST', canvas.width / 2, yPos - 5);
                    
                    ctx.font = 'bold 36px Arial';
                    ctx.fillText(`${Math.round(calculator.costs.total).toLocaleString()}`, canvas.width / 2, yPos + 30);
                    
                    yPos += 60;
                    ctx.font = '20px Arial';
                    const costPerSqft = calculator.costs.total / calculator.data.sqft;
                    ctx.fillText(`Cost per Square Foot: ${costPerSqft.toFixed(2)}`, canvas.width / 2, yPos);
                    
                    // Important Notes
                    yPos += 80;
                    ctx.fillStyle = '#fff3cd';
                    ctx.fillRect(40, yPos - 20, canvas.width - 80, 140);
                    ctx.strokeStyle = '#856404';
                    ctx.strokeRect(40, yPos - 20, canvas.width - 80, 140);
                    
                    ctx.fillStyle = '#856404';
                    ctx.font = 'bold 18px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`⚠️ IMPORTANT NOTES`, 60, yPos + 10);
                    
                    yPos += 35;
                    ctx.font = '14px Arial';
                    ctx.fillText(`• This is a preliminary estimate based on current Las Vegas market rates`, 60, yPos);
                    yPos += 20;
                    ctx.fillText(`• Final costs may vary based on site conditions and material selection`, 60, yPos);
                    yPos += 20;
                    ctx.fillText(`• Estimate valid for 30 days from generation date`, 60, yPos);
                    yPos += 20;
                    ctx.fillText(`• Professional consultation recommended for final project planning`, 60, yPos);
                    
                    // Contact Footer
                    yPos = canvas.height - 100;
                    ctx.fillStyle = '#E5A825';
                    ctx.fillRect(0, yPos - 20, canvas.width, 120);
                    
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 18px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ASF Design - American Southwest Framing', canvas.width / 2, yPos + 15);
                    
                    ctx.font = '16px Arial';
                    ctx.fillText('📍 4485 Riviera Ridge Ave, Las Vegas, NV 89115', canvas.width / 2, yPos + 40);
                    
                    ctx.font = '14px Arial';
                    ctx.fillText('📞 (702) 643-2900 • ✉️ info@aswframing.com', canvas.width / 2, yPos + 60);
                    
                    ctx.font = '12px Arial';
                    ctx.fillText('🌐 www.aswframing.com • Licensed, Bonded & Insured', canvas.width / 2, yPos + 75);
                    
                    // Download
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().slice(0, 10);
                    link.download = `ASF_Estimate_${calculator.data.sqft}sqft_${tierName}_${timestamp}.png`;
                    link.href = canvas.toDataURL('image/png', 1.0);
                    link.click();
                    
                    alert('✅ Detailed PNG estimate downloaded successfully!');
                }
                
            } catch (error) {
                console.error('Error generating PNG:', error);
                alert('❌ Error generating PNG file. Please try again.');
            }
        }
        
        // Modal functions
        function openDetailsModal() {
            if (calculator.data.sqft <= 0) {
                alert('Please enter the square footage first!');
                document.getElementById('sqft').focus();
                return;
            }
            
            const modal = document.getElementById('details-modal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.style.filter = 'blur(3px)';
            modalContent.style.opacity = '0.7';
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            setTimeout(() => {
                calculator.updateModal();
                
                modalContent.style.transition = 'all 0.4s ease';
                modalContent.style.filter = 'blur(0px)';
                modalContent.style.opacity = '1';
                
                modalContent.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    modalContent.style.transform = 'scale(1)';
                }, 50);
                
            }, 200);
        }
        
        function closeModal() {
            const modal = document.getElementById('details-modal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.style.transition = 'all 0.3s ease';
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0.7';
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
                modalContent.style.filter = 'blur(0px)';
            }, 300);
        }
        
        // Smooth Dissolve Dark Mode Toggle - No Overlays
        function toggleDarkMode() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');
            
            // Check if elements exist
            if (!icon || !text) {
                console.error('Dark mode toggle elements not found');
                return;
            }
            
            // Add rotating animation to icon
            icon.classList.add('rotating');
            
            // Toggle mode immediately for smooth dissolve
            const isDark = body.classList.toggle('dark-mode');
            
            // Update toggle appearance with slight delay for smooth transition
            setTimeout(() => {
                if (isDark) {
                    icon.textContent = '☀️';
                    text.textContent = 'Light Mode';
                } else {
                    icon.textContent = '🌙';
                    text.textContent = 'Dark Mode';
                }
            }, 200);
            
            // Save preference
            try {
                localStorage.setItem('darkMode', isDark);
            } catch (e) {
                console.warn('Could not save dark mode preference');
            }
            
            // Remove icon rotation after animation
            setTimeout(() => {
                if (icon) {
                    icon.classList.remove('rotating');
                }
            }, 600);
            
            // Visual feedback for toggle button
            const toggle = document.querySelector('.dark-mode-toggle');
            if (toggle) {
                toggle.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    toggle.style.transform = '';
                }, 150);
            }
        }
        
        function loadDarkModePreference() {
            try {
                const savedMode = localStorage.getItem('darkMode');
                const icon = document.getElementById('theme-icon');
                const text = document.getElementById('theme-text');
                
                if (savedMode === 'true' && icon && text) {
                    document.body.classList.add('dark-mode');
                    icon.textContent = '☀️';
                    text.textContent = 'Light Mode';
                }
            } catch (e) {
                console.warn('Could not load dark mode preference');
            }
        }
        
        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            calculator = new ASFCalculator();
            
            // Setup admin access (5 clicks or Ctrl+Shift+A)
            let clickCount = 0;
            let clickTimer = null;

            const adminTrigger = document.getElementById('admin-trigger');
            if (adminTrigger) {
                adminTrigger.addEventListener('click', function() {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        clickTimer = setTimeout(() => {
                            clickCount = 0;
                        }, 2000);
                    } else if (clickCount === 5) {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        
                        const password = prompt('🔐 Enter admin password:');
                        if (password === 'asf2025' || password === 'admin') {
                            window.open('https://raxc19.github.io/ASF-Calculator/admin.html', '_blank');
                        } else if (password !== null) {
                            alert('❌ Incorrect password');
                        }
                    }
                });
            }

            // Load dark mode preference
            setTimeout(() => {
                loadDarkModePreference();
            }, 100);
            
            // Close modal handlers
            window.addEventListener('click', function(e) {
                const modal = document.getElementById('details-modal');
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('details-modal');
                    if (modal.style.display === 'block') {
                        closeModal();
                    }
                }
                
                // Admin shortcut: Ctrl+Shift+A
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    const password = prompt('🔐 Enter admin password:');
                    if (password === 'asf2025' || password === 'admin') {
                        window.open('https://raxc19.github.io/ASF-Calculator/admin.html', '_blank');
                    } else if (password !== null) {
                        alert('❌ Incorrect password');
                    }
                }
            });
            
            console.log('🏗️ ASF Calculator loaded successfully');
            console.log('✨ Admin access: Click gear icon 5 times or Ctrl+Shift+A');
            console.log('🔑 Password: asf2025 or admin');
            console.log('💰 Using admin prices:', Object.keys(calculator.getAdminPrices()).length > 0);
        });
    </script>
</body>
</html>
